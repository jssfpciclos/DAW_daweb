# CASO PRÁCTICO. Construción de imagenes con DockerFile

## Objetivo

Aprender a crear imágenes con Docker, a través de DockerFile

## Requisitos

- Tener instalado Docker en nuestro ordenador.
- Leer documentación DockerFile [aquí](../021.creacion-imagenes.md)

## ▶️ Caso práctico 1. Construcción de imágenes con una Aplicación Python

En este ejemplo vamos a construir una imagen para servir una aplicación escrita en Python utilizando el framework `flask`. La aplicación será servida en el puerto `3000/tcp`. 

En el contexto vamos a tener el fichero Dockerfile y un directorio, llamado app con nuestra aplicación.
Descargar los recursos para este ejemplo desde [aquí](../res/docker-file.caso-practico1.resources.rar)

En este caso vamos a usar una imagen base de un sistema operativo sin ningún servicio. El fichero Dockerfile será el siguiente:

```dockerfile	
FROM debian:buster-slim
# Instalamos python3 y pip3, y limpiamos la cache
RUN apt-get update && apt-get install -y python3-pip  && apt-get clean && rm -rf /var/lib/apt/lists/*
# Copiamos la carpeta app/ (la aplicación) al directorio /usr/share
COPY app /usr/share/app
# Establecemos el directorio de trabajo donde hemos copiado la aplicación
WORKDIR /usr/share/app
# Instalamos las dependencias de la aplicación
RUN pip3 install --no-cache-dir -r requirements.txt
# Exponemos el puerto 3000
EXPOSE 3000
# Ejecutamos la aplicación. Ya que el directorio de trabajo es /usr/share/app, no es necesario poner la ruta completa
CMD [ "python3", "app.py"]
```

**Algunas consideraciones:**

- Sólo tenemos que instalar pip, que utilizaremos posteriormente para instalar los paquetes Python.
- Copiamos nuestra aplicación en cualquier directorio. (En este caso /usr/share/app)
- Con `WORKDIR` nos posicionamos en el directorio indicado. Todas las instrucciones posteriores se realizarán sobre ese directorio.
- Instalamos los paquetes python con pip, que están listados en el fichero requirements.txt.
- El proceso que se va a ejecutar por defecto al iniciar el contenedor será python3 app.py que arranca un servidor web en el puerto 3000/tcp ofreciendo la aplicación.


**Construcción de la imagen**

Para construir la imagen, nos situamos en el directorio donde tenemos el fichero Dockerfile y ejecutamos:

```bash
docker build -t iessdf/imagen-web-python:v1 .
```

Comprobar que la imagen se ha creado:

```bash
docker images

REPOSITORY                 TAG                 IMAGE ID            CREATED             SIZE
iessdf/imagen-web-python   v1                  5f6b6b6b6b6b        2 minutes ago       126MB
```

Y crear el contendores a partir de la imagen:

```bash
docker run -d --name web-python -p 80:3000 iessdf/imagen-web-python:v1
```

Y acceder con el navegador a la dirección http://localhost


<img src="res/img/04.caso-practico1.png">